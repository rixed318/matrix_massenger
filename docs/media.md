# Медиа-записи в Matrix Messenger

Этот документ описывает, как клиент работает с локальной записью аудио- и видеосообщений, а также требования к окружению пользователя.

## Видеосообщения

Matrix Messenger поддерживает запись коротких клипов через `MediaRecorder` прямо из окна набора сообщения. Функция доступна на десктопе и в браузерах, где реализованы следующие API:

- `navigator.mediaDevices.getUserMedia`
- `MediaRecorder` с поддержкой кодеков `video/webm;codecs=vp8,opus` или новее

### Процесс записи

1. Нажмите на кнопку с камерой внизу поля ввода.
2. Приложение запросит разрешение на доступ к камере и микрофону.
3. После подтверждения начнётся запись; в окне чата отображается живой предпросмотр и таймер.
4. Максимальная длительность — **30 секунд**. По достижении лимита запись автоматически останавливается.
5. Перед отправкой можно просмотреть клип, удалить его или записать заново.
6. Сообщение отправляется как событие `m.video` с загруженным превью (thumbnail).

### Требования

- Встроенная или внешняя камера и микрофон.
- Современный браузер или среда выполнения Tauri с поддержкой `MediaRecorder` (Chrome 49+, Firefox 29+, Safari 15.4+).
- Разрешения на доступ к аудио и видео устройствам; без них запись недоступна.
- Стабильное сетевое соединение для загрузки видео и изображений превью.

### Особенности безопасности

- Видеофайлы загружаются на homeserver Matrix. В зашифрованных комнатах перед отправкой применяется та же стратегия, что и для других вложений.
- Если в комнате активирован таймер самоуничтожения, он добавляется к событию и распространяется на отправленный клип.

## Голосовые сообщения

Поддерживаются и голосовые сообщения через `MediaRecorder` (только аудио). Ограничений по длительности нет, однако рекомендуется не превышать несколько минут для комфортной отправки.

### Общие требования

- Микрофон и разрешение на его использование.
- Поддержка `MediaRecorder` с кодеком Opus (`audio/ogg;codecs=opus`).

## Известные ограничения

- Safari на iOS может требовать явное взаимодействие (тап по экрану) перед началом воспроизведения записанных клипов.
- Если браузер не поддерживает `MediaRecorder`, кнопка видеозаписи скрывается или выводит сообщение об ошибке.
- Лимиты файла и битрейта определяются настройками homeserver'а (по умолчанию 100 МБ для Synapse).

Для дополнительной информации смотрите также [docs/search.md](search.md) и [docs/plugins.md](plugins.md).
