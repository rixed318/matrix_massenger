# Secure Cloud: локальные ML-детекторы

Локальный ML-детектор предназначен для оперативной классификации исходящих и входящих сообщений без передачи данных в облако. Он дополняет эвристические проверки и используется автоматически при включённом премиум-режиме Secure Cloud.

## Лёгкая текстовая модель

- Параметры модели публикуются в виде JSON-файла `src/assets/secure-cloud/lite-model.json`. Он содержит веса линейного классификатора (шесть коэффициентов и смещение для каждой из категорий: spam, phishing, nsfw), обученного на признаках частоты ключевых слов, NSFW-триггеров, наличия ссылок, доли заглавных символов и нормализованной длины сообщения.
- Размер JSON не превышает нескольких сотен байт, что позволяет мгновенно доставлять обновления даже при медленном соединении и хранить модель в истории git без бинарных артефактов.
- При корректировке архитектуры обновляйте JSON вместе с описанием признаков в коде (`computeFeatureVector`) и убедитесь, что веса соответствуют новой размерности.

## Кеширование и прогрев

- При первой активации детектора JSON модели считывается через `fetch` и десериализуется в объект, который кешируется в памяти (`modelDataCache`).
- Если в среде доступен Cache Storage (`caches.open`), текст модели сохраняется в кэше браузера (`secure-cloud-lite-models`), что позволяет работать офлайн.
- После загрузки веса инициализируют простой логистический классификатор; повторные вызовы не инициируют повторную загрузку данных.
- Метод `warmup()` детектора автоматически вызывается при объединении конфигураций. Благодаря этому статус `getStatus()` отображает стадию загрузки ещё до первого события.

## Настройки пользователя

- Для локальной модели доступны два параметра:
  - **Порог срабатывания** (0.2–0.95) — минимальный риск, при котором сигнал попадает в итоговое уведомление. Значение по умолчанию: 0.6.
  - **Язык модели** — `auto`, `ru` или `en`. В режиме `auto` язык определяется по преобладающему алфавиту в сообщении.
- Управление отображается в разделе «Детекторы Secure Cloud» и сохраняется в профиле пользователя. Изменения мгновенно передаются активной сессии `startSecureCloudSession`.

## Премиум-режим

- При `enablePremium = true` локальный ML-детектор становится обязательным (`required`) и не может быть отключён пользователем.
- Если загрузка модели завершается ошибкой, статус детектора обновляется, а обработчик `onError` сессии получает подробное сообщение. Это позволяет вывести предупреждение в интерфейсе и не блокирует работу остальных детекторов.
