# Безопасность и Travel Mode

## Блокировка приложения

Matrix Messenger поддерживает системную блокировку приложения в настольной сборке (Tauri). После задания PIN-кода и, при желании, биометрической разблокировки скрытые чаты становятся доступны только после проверки пользователя. Конфигурация хранится в зашифрованном хранилище плагина secure-storage.

## Travel Mode

**Travel Mode** предназначен для поездок и ситуаций, когда требуется быстро скрыть чувствительные комнаты и отключить уведомления.

### Возможности режима

- Автоматическое скрытие выбранных комнат (используются привычные «скрытые чаты»).
- Блокировка пуш-уведомлений и локальных всплывающих уведомлений от скрытых комнат до выхода из режима.
- Очистка локального поискового кеша (IndexedDB/SQLite) для скрытых комнат.
- Синхронизация состояния через Matrix account data, чтобы другие клиенты/веб-воркер также знали о включённом режиме.
- Временные PIN-окна: после успешной разблокировки Travel Mode открывает короткое окно, в рамках которого повторный доступ выполняется без дополнительного запроса PIN.

### Включение Travel Mode

1. Откройте **Настройки → Безопасность** (доступно только в настольной версии).
2. Убедитесь, что блокировка приложения активна и задан PIN.
3. В секции «Travel Mode» выберите:
   - **Авто-таймер** — время, через которое режим отключится автоматически.
   - **Автологинг** — если включено, клиент выполнит logout сразу после активации.
   - **Очистку кеша** — удаляет историю и медиа из локального поиска.
4. Нажмите «Включить Travel Mode». Текущий список скрытых комнат фиксируется в account data и применяется ко всем сессиям.

Отключить режим можно в той же секции настроек или закрыть баннер в чате и открыть настройки для завершения режима.

### Рекомендации для поездок

- Перед выездом убедитесь, что все необходимые комнаты помечены как скрытые.
- Настройте авто-таймер и автологинг, чтобы минимизировать риск доступа посторонних.
- После возвращения отключите режим и, при необходимости, пересоздайте локальный кеш (сообщения и медиа будут перезагружены из сервера при открытии комнат).

### Поведение в интерфейсе

- В главном окне чата отображается баннер о том, что Travel Mode активен; с него можно перейти к настройкам.
- Повторная разблокировка скрытых комнат возможна через PIN или биометрию; Travel Mode фиксирует временные окна, чтобы не запрашивать PIN слишком часто.

## Автотесты

В репозитории добавлены unit-тесты для сервиса блокировки, проверяющие повторную разблокировку и создание временных PIN-окон при активном Travel Mode.
